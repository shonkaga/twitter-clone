<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Croppie Test</title>
    <!---bootstrap css-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <!---bootstrap icons-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <!---bootstrap croppie css for image croppping-->
    <link href="./static/css/croppie.css" rel="stylesheet" type="text/css" />
    <!---personal bootstrap-->
    <link href="./static/css/mystyle.css" rel="stylesheet" type="text/css" />

</head>

<body>


    <!---Jquery-->
    <script src='./static/js/jquery-3.6.0.min.js'></script>
    <!---bootstrap bundle js-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js " integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4 " crossorigin="anonymous "></script>
    <!---autosize for textareas -->
    <script src='./static/js/autosize.js'></script>
    <!---croppie js for pictues for in browser cropping-->
    <script src='./static/js/croppie.min.js'></script>
    <!---personal script page-->
    <script src="./static/js/myscript.js "></script>



    <center>
        <input id="upload" type="file" class="upload-hidden" accept="image/*" />
        <a href="" id="upload_replacement">Upload your photo</a>

        <hr>
        <div class="result">
        </div>

    </center>
    <div class="modal " id="ImageCropModal" tabindex="-1" aria-labelledby="ImageCropModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content postDiv">
                <div class="modal-header">
                    <h5 class="modal-title" id="ImageCropModalLabel">Crop your image</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <center>
                        <div class="croppie-container" style=" height:600px; width:600px;">
                            <div id="upload-demo">
                            </div>

                        </div>
                    </center>
                    <br><br>


                </div>
                <div class="modal-footer">
                    <button class=" btn btn-outline-primary  followButtoncopy   hide-modal">Cancel</button>
                    <button class="result-show btn btn-outline-primary  followButtoncopy">Save</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        var $uploadCrop;
        //$('#ImageCropModal').modal('hide')

        function readFile(input) {
            if (!$uploadCrop) {
                $uploadCrop = $('#upload-demo').croppie({
                    viewport: {
                        width: 600,
                        height: 300,
                    },
                    enableExif: true
                });
            }

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function(e) {
                    $('#upload-demo').addClass('ready');
                    $uploadCrop.croppie('bind', {
                        url: e.target.result
                    }).then(function() {
                        console.log('jQuery bind complete');
                    });

                }

                reader.readAsDataURL(input.files[0]);
            } else {
                console.log("Sorry - you're browser doesn't support the FileReader API");
            }
        };


        $('#upload').on('change', function() {
            $('#ImageCropModal').modal('show');

            readFile(this);
            $('#upload').val("")

        });



        $(document).on("click", ".result-show", function(ev) {
            console.log("result show");
            $uploadCrop.croppie('result', {
                type: 'canvas',
                size: 'viewport'
            }).then(function(resp) {

                imagehtml = '<img src="' + resp + '">'
                    //console.log(imagehtml);
                $('.result').html(imagehtml);

                $('.result').append('<button class=" btn btn-outline-primary  followButtoncopy  deleteImage">Cancel</button>')
                $('#ImageCropModal').modal('hide');

            });
        });

        $("#upload_replacement").on('click', function(e) {
            e.preventDefault();
            $("#upload:hidden").trigger('click');
        });


        $(document).on("click", ".deleteImage", function(e) {
            console.log("delete")
            $('.result').html("");
        });
    </script>
    <!--<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ImageCropModal">
        Launch demo modal
      </button>-->







</body>

</html>